!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).frpuccino=e()}}(function(){var e,t="undefined"==typeof document?void 0:document,n=!!t&&"content"in t.createElement("template"),r=!!t&&t.createRange&&"createContextualFragment"in t.createRange();function o(e,t){var n=e.nodeName,r=t.nodeName;return n===r||!!(t.actualize&&n.charCodeAt(0)<91&&r.charCodeAt(0)>90)&&n===r.toUpperCase()}function a(e,t,n){e[n]!==t[n]&&(e[n]=t[n],e[n]?e.setAttribute(n,""):e.removeAttribute(n))}var i={OPTION:function(e,t){var n=e.parentNode;if(n){var r=n.nodeName.toUpperCase();"OPTGROUP"===r&&(r=(n=n.parentNode)&&n.nodeName.toUpperCase()),"SELECT"!==r||n.hasAttribute("multiple")||(e.hasAttribute("selected")&&!t.selected&&(e.setAttribute("selected","selected"),e.removeAttribute("selected")),n.selectedIndex=-1)}a(e,t,"selected")},INPUT:function(e,t){a(e,t,"checked"),a(e,t,"disabled"),e.value!==t.value&&(e.value=t.value),t.hasAttribute("value")||e.removeAttribute("value")},TEXTAREA:function(e,t){var n=t.value;e.value!==n&&(e.value=n);var r=e.firstChild;if(r){var o=r.nodeValue;if(o==n||!n&&o==e.placeholder)return;r.nodeValue=n}},SELECT:function(e,t){if(!t.hasAttribute("multiple")){for(var n,r,o=-1,a=0,i=e.firstChild;i;)if("OPTGROUP"===(r=i.nodeName&&i.nodeName.toUpperCase()))i=(n=i).firstChild;else{if("OPTION"===r){if(i.hasAttribute("selected")){o=a;break}a++}!(i=i.nextSibling)&&n&&(i=n.nextSibling,n=null)}e.selectedIndex=o}}},u=1,d=3,c=8;function l(){}function s(e){return e.id}var f,m=(f=function(e,t){var n,r,o,a,i=t.attributes;if(11!==t.nodeType&&11!==e.nodeType){for(var u=0;u<i.length;u++)r=(n=i[u]).name,o=n.namespaceURI,a=n.value,o?(r=n.localName||r,e.getAttributeNS(o,r)!==a&&("xmlns"===n.prefix&&(r=n.name),e.setAttributeNS(o,r,a))):e.getAttribute(r)!==a&&e.setAttribute(r,a);for(var d=e.attributes,c=0;c<d.length;c++)r=(n=d[c]).name,(o=n.namespaceURI)?(r=n.localName||r,t.hasAttributeNS(o,r)||e.removeAttributeNS(o,r)):t.hasAttribute(r)||e.removeAttribute(r)}},function(a,m,p){if(p||(p={}),"string"==typeof m)if("#document"===a.nodeName||"HTML"===a.nodeName){var v=m;(m=t.createElement("html")).innerHTML=v}else h=(h=m).trim(),m=n?function(e){var n=t.createElement("template");return n.innerHTML=e,n.content.childNodes[0]}(h):r?function(n){return e||(e=t.createRange()).selectNode(t.body),e.createContextualFragment(n).childNodes[0]}(h):function(e){var n=t.createElement("body");return n.innerHTML=e,n.childNodes[0]}(h);var h,b=p.getNodeKey||s,N=p.onBeforeNodeAdded||l,g=p.onNodeAdded||l,T=p.onBeforeElUpdated||l,A=p.onElUpdated||l,y=p.onBeforeNodeDiscarded||l,S=p.onNodeDiscarded||l,C=p.onBeforeElChildrenUpdated||l,E=!0===p.childrenOnly,w=Object.create(null),k=[];function O(e){k.push(e)}function x(e,t,n){!1!==y(e)&&(t&&t.removeChild(e),S(e),function e(t,n){if(t.nodeType===u)for(var r=t.firstChild;r;){var o=void 0;n&&(o=b(r))?O(o):(S(r),r.firstChild&&e(r,n)),r=r.nextSibling}}(e,n))}function I(e){g(e);for(var t=e.firstChild;t;){var n=t.nextSibling,r=b(t);if(r){var a=w[r];a&&o(t,a)&&(t.parentNode.replaceChild(a,t),U(a,t))}I(t),t=n}}function U(e,n,r){var a=b(n);if(a&&delete w[a],!r){if(!1===T(e,n))return;if(f(e,n),A(e),!1===C(e,n))return}"TEXTAREA"!==e.nodeName?function(e,n){var r,a,l,s,f,m=n.firstChild,p=e.firstChild;e:for(;m;){for(s=m.nextSibling,r=b(m);p;){if(l=p.nextSibling,m.isSameNode&&m.isSameNode(p)){m=s,p=l;continue e}a=b(p);var v=p.nodeType,h=void 0;if(v===m.nodeType&&(v===u?(r?r!==a&&((f=w[r])?l===f?h=!1:(e.insertBefore(f,p),a?O(a):x(p,e,!0),p=f):h=!1):a&&(h=!1),(h=!1!==h&&o(p,m))&&U(p,m)):v!==d&&v!=c||(h=!0,p.nodeValue!==m.nodeValue&&(p.nodeValue=m.nodeValue))),h){m=s,p=l;continue e}a?O(a):x(p,e,!0),p=l}if(r&&(f=w[r])&&o(f,m))e.appendChild(f),U(f,m);else{var g=N(m);!1!==g&&(g&&(m=g),m.actualize&&(m=m.actualize(e.ownerDocument||t)),e.appendChild(m),I(m))}m=s,p=l}!function(e,t,n){for(;t;){var r=t.nextSibling;(n=b(t))?O(n):x(t,e,!0),t=r}}(e,p,a);var T=i[e.nodeName];T&&T(e,n)}(e,n):i.TEXTAREA(e,n)}!function e(t){if(t.nodeType===u||11===t.nodeType)for(var n=t.firstChild;n;){var r=b(n);r&&(w[r]=n),e(n),n=n.nextSibling}}(a);var P,R,_=a,j=_.nodeType,V=m.nodeType;if(!E)if(j===u)V===u?o(a,m)||(S(a),_=function(e,t){for(var n=e.firstChild;n;){var r=n.nextSibling;t.appendChild(n),n=r}return t}(a,(P=m.nodeName,(R=m.namespaceURI)&&"http://www.w3.org/1999/xhtml"!==R?t.createElementNS(R,P):t.createElement(P)))):_=m;else if(j===d||j===c){if(V===j)return _.nodeValue!==m.nodeValue&&(_.nodeValue=m.nodeValue),_;_=m}if(_===m)S(a);else{if(m.isSameNode&&m.isSameNode(_))return;if(U(_,m,E),k)for(var M=0,B=k.length;M<B;M++){var D=w[k[M]];D&&x(D,D.parentNode,!1)}}return!E&&_!==a&&a.parentNode&&(_.actualize&&(_=_.actualize(a.ownerDocument||t)),a.parentNode.replaceChild(_,a)),_}),p={};Object.defineProperty(p,"__esModule",{value:!0}),p.default={onblur:"blur",onchange:"change",oncontextmenu:"contextmenu",onfocus:"focus",oninput:"input",oninvalid:"invalid",onreset:"reset",onsearch:"search",onselect:"select",onsubmit:"submit",onkeydown:"keydown",onkeypress:"keypress",onkeyup:"keyup",onclick:"click",ondblclick:"dblclick",onmousedown:"mousedown",onmousemove:"mousemove",onmouseout:"mouseout",onmouseover:"mouseover",onmouseup:"mouseup",onwheel:"wheel",onanimationend:"animationend",onanimationstart:"animationstart",ondrag:"drag",ondragend:"dragend",ondragenter:"dragenter",ondragexit:"dragexit",ondragleave:"dragleave",ondragover:"dragover",ondragstop:"dragstop",ondrop:"drop"};var v={},h=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(v,"__esModule",{value:!0});const b=require("@most/core"),N=h(m),g=h(function(e){return e=e||Object.create(null),{on:function(t,n){(e[t]||(e[t]=[])).push(n)},off:function(t,n){e[t]&&e[t].splice(e[t].indexOf(n)>>>0,1)},emit:function(t,n){(e[t]||[]).slice().map(function(e){e(n)}),(e["*"]||[]).slice().map(function(e){e(t,n)})}}}),T=require("@most/scheduler"),A=h(p);function y(e){if(!1===e)throw new Error("StreamElement cannot be shallow cloned");const t=document.createElement("div");return N.default(t,Element.prototype.cloneNode.call(this,!0)),t}function S(e){return{createTask:e,map:function(t){return S((n,r)=>e({event:(e,r)=>{n.event(e,{action:t(r.action)})},end:e=>{n.end(e)},error:(e,t)=>{n.error(e,t)}},r))}}}function C(e,t,n){let r,o;return t&&(t[e]=(e=>{r&&r.event(o.currentTime(),e)}),t[e].mapFn=n),{run:(e,t)=>(r=e,o=t,{dispose:()=>{r=void 0}})}}function E(e,t){return Object.keys(A.default).forEach(n=>{t[n]?e[n]=t[n]:e[n]&&(e[n]=void 0)}),!0}v.ACTION="ACTION",v.cloneNode=y,v.mapElement=function(e,t){const n=y.call(t);return n.eventStream=b.map(e,function e(t,n){const r=[];Object.keys(A.default).forEach(e=>{if(n[e]&&n[e].mapFn){const o=n[e].mapFn;r.push(b.map(o,C(e,t,o)))}});let o=b.mergeArray(r);for(let a=0;a<t.children.length;a++){const r=t.children[a],i=n.children[a];o=b.merge(o,e(r,i))}return o}(n,t)),n},v.mapTaskCreator=function(e,t){return S(t).map(e).createTask},v.taskGenerator=S,v.createApplication=function(e){const{mount:t,init:n,update:r,view:o,runTasks:a}=e,i=e.scheduler||T.newDefaultScheduler(),u=g.default(),d={run:(e,t)=>{const n=n=>e.event(t.currentTime(),n);return u.on(v.ACTION,n),{dispose:()=>{u.off(v.ACTION,n)}}}},c=b.loop((e,t)=>{let n,a;const u=r(e,t.action,i);Array.isArray(u)?[a,n]=u:a=u;const d=o(a);return{seed:a,value:{view:d,task:n,eventStream:b.take(1,b.map(e=>({action:e}),d.eventStream))}}},n,d),l={event:function(e,n){const r=n.eventStream?null:n;if(r){const t={eventStream:b.now(r)};return this.event(e,t)}const o=n;if(o.view&&N.default(t,o.view,{onBeforeElUpdated:E}),o.task&&!1!==a){const e=Array.isArray(o.task)?o.task:[o.task],t=T.newTimeline();e.forEach(e=>{const n=e(l,i);t.add(n)}),t.runTasks(0,e=>e.run())}const d=o.eventStream.run({event:(e,t)=>{t.time||(t.time=e),u.emit(v.ACTION,t)},end:()=>{d.dispose()},error:(e,t)=>{throw console.error(t),t}},i)},end:()=>{},error:(e,t)=>{throw console.error(t),t}};return{applicationStream:c,applicationSink:l,scheduler:i,eventSource:u,run:e=>{const t=c.run(l,i);return u.emit(v.ACTION,{time:i.currentTime(),action:e}),t}}},v.createElement=function(e,t,...n){const r=document.createElement(e);return r.eventStream=b.empty(),t&&Object.keys(t).forEach(function(e){const n=t[e];if(A.default[e]&&n){const t=n.constructor===Function?n:()=>n;r.eventStream=b.merge(r.eventStream,b.map(t,C(e,r,t)))}else-1===["className","id"].indexOf(e)?null!=n&&r.setAttribute(e,n):r[e]=n}),n.forEach(function e(t){if("number"!=typeof t){if(t)if(t&&t.constructor===String){const e=document.createTextNode(t);r.appendChild(e)}else Array.isArray(t)?t.forEach(e):(r.appendChild(t),r.eventStream=b.merge(r.eventStream,t.eventStream),r.cloneNode=y,t.eventStream=null)}else{const e=document.createTextNode(t.toString());r.appendChild(e)}}),r},v.render=function(e,t){0===e.children.length&&e.appendChild(t);const n=e.children[0];N.default(n,t,{onBeforeElUpdated:E})};var w={};Object.defineProperty(w,"__esModule",{value:!0});const k=require("@most/scheduler"),O=require("@most/core");w.record=function(e,t){let n;const r=[],o=e=>{!n&&e.time&&(n=e.time-500),r.push(e)};return e.on(v.ACTION,o),function({mount:a,update:i,view:u,init:d}){e.off(v.ACTION,o);const c=k.schedulerRelativeTo(-1*(n-t.currentTime()),t),{applicationSink:l,applicationStream:s}=v.createApplication({view:u,update:i,init:d,mount:a,scheduler:c,runTasks:!1}),f=O.mergeArray(r.map(e=>O.at(e.time,e)));O.merge(s,f).run(l,c)}};var x={};function I(e){for(var t in e)x.hasOwnProperty(t)||(x[t]=e[t])}return Object.defineProperty(x,"__esModule",{value:!0}),I(v),I(w),x});
//# sourceMappingURL=frpuccino.umd.js.map