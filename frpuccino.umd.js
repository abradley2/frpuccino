!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).frpuccino=e()}}(function(){var e,t=function(e){var t;return function(n){return t||e(t={exports:{},parent:n},t.exports),t.exports}},n=t(function(e,t){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(o),a=require("@most/core"),u=n(b),d=n(N),c=require("@most/scheduler"),l=n(g),s=r({});function f(e){if(!1===e)throw new Error("StreamElement cannot be shallow cloned");const t=document.createElement("div");return u.default(t,Element.prototype.cloneNode.call(this,!0)),t}function m(e,t){return p(t).map(e).createTask}function p(e){return{createTask:e,map:function(t){return p((n,r)=>e({event:(e,r)=>{n.event(e,{action:t(r.action)})},end:e=>{n.end(e)},error:(e,t)=>{n.error(e,t)}},r))}}}let v;function h(e,t,n){let r,o;return t&&(t[e]=(e=>{r&&r.event(o.currentTime(),e)}),t[e].mapFn=n),{run:(e,t)=>(r=e,o=t,{dispose:()=>{r=void 0}})}}function A(e,t){return Object.keys(l.default).forEach(n=>{t[n]?e[n]=t[n]:e[n]&&(e[n]=void 0)}),!0}t.ACTION="ACTION",t.cloneNode=f,t.mapElement=function(e,t){const n=f.call(t);return n.eventStream=a.map(e,function e(t,n){const r=[];Object.keys(l.default).forEach(e=>{if(n[e]&&n[e].mapFn){const o=n[e].mapFn;r.push(a.map(o,h(e,t,o)))}});let o=a.mergeArray(r);for(let i=0;i<t.children.length;i++){const r=t.children[i],u=n.children[i];o=a.merge(o,e(r,u))}return o}(n,t)),n},t.mapTaskCreator=m,t.taskGenerator=p,t.mapUpdateResult=function(e,t,n){const[r,o]=Array.isArray(n)?n:[n,null],i=(Array.isArray(o)?o:[o]).filter(e=>!!e).map(e=>m(t,e));return[e(r),i]},t.createApplication=function(e){const{mount:n,init:r,update:o,view:l,runTasks:f,mapUrlChange:m}=e,p=e.scheduler||c.newDefaultScheduler(),h=d.default(),b=()=>{h.emit(t.ACTION,{action:m(window.location)})};m&&(window.addEventListener("urlchange",b),v||(i.default(),v=!0));const N={run:(n,r)=>{const o=e=>n.event(r.currentTime(),e);return h.on(t.ACTION,o),{dispose:()=>{h.off(t.ACTION,o),e.mapUrlChange&&h.off(t.ACTION,b)}}}};let g=a.loop((e,t)=>{let n,r;const i=o(e,t.action,p);Array.isArray(i)?[r,n]=i:r=i;const u=l(r);return{seed:r,value:{view:u,task:n,eventStream:a.take(1,a.map(e=>({action:e}),u.eventStream))}}},r,N);m&&(g=a.startWith({eventStream:a.now({action:m(window.location)})},g));const y={event:function(e,r){const o=r.eventStream?null:r;if(o){const t={eventStream:a.now(o)};return this.event(e,t)}const i=r;if(i.view&&u.default(n,i.view,{onBeforeElUpdated:A}),i.task&&!1!==f){const e=Array.isArray(i.task)?i.task:[i.task],t=c.newTimeline();e.forEach(e=>{const n=e(y,p);t.add(n)}),t.runTasks(0,e=>e.run())}const d=i.eventStream.run({event:(e,n)=>{n.time||(n.time=e),h.emit(t.ACTION,n)},end:()=>{d.dispose()},error:(e,t)=>{throw console.error(t),t}},p)},end:()=>{},error:(e,t)=>{throw console.error(t),t}};return{applicationStream:g,applicationSink:y,scheduler:p,eventSource:h,run:e=>{const n=g.run(y,p);return h.emit(t.ACTION,{time:p.currentTime(),action:e}),n},record:()=>{const e=s.record(h,p);return t=>e(t)}}},t.createElement=function(e,t,...n){const r=document.createElement(e);return r.eventStream=a.empty(),t&&Object.keys(t).forEach(function(e){const n=t[e];if(l.default[e]&&n){const t=n.constructor===Function?n:()=>n;r.eventStream=a.merge(r.eventStream,a.map(t,h(e,r,t)))}else-1===["className","id"].indexOf(e)?null!=n&&r.setAttribute(e,n):r[e]=n}),n.forEach(function e(t){if("number"!=typeof t){if(t)if(t&&t.constructor===String){const e=document.createTextNode(t);r.appendChild(e)}else Array.isArray(t)?t.forEach(e):(r.appendChild(t),r.eventStream=a.merge(r.eventStream,t.eventStream),r.cloneNode=f,t.eventStream=null)}else{const e=document.createTextNode(t.toString());r.appendChild(e)}}),r},t.render=function(e,t){0===e.children.length&&e.appendChild(t);const n=e.children[0];u.default(n,t,{onBeforeElUpdated:A})}}),r=t(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n({}),o=require("@most/scheduler"),i=require("@most/core");t.record=function(e,t){let n;const a=[],u=e=>{!n&&e.time&&(n=e.time-500),a.push(e)};return e.on(r.ACTION,u),function({mount:d,update:c,view:l,init:s}){e.off(r.ACTION,u);const f=o.schedulerRelativeTo(-1*(n-t.currentTime()),t),m=r.createApplication({view:l,update:c,init:s,mount:d,scheduler:f,runTasks:!1}),{applicationSink:p,applicationStream:v}=m,h=i.mergeArray(a.map(e=>i.at(e.time,e)));return{application:m,run:()=>i.merge(v,h).run(p,f)}}}}),o=function(e){const t=()=>{const e=new window.CustomEvent("urlchange",{detail:document.location});window.dispatchEvent(e)},n=()=>{t()},r=n=>{let r=n.target;for(;r!==document.body;){if("A"===r.nodeName.toUpperCase()){const o=r.getAttribute("data-link");if("replaceState"!==o&&"pushState"!==o)break;n.preventDefault(),window.history[o](e?e(r):window.history.state,r.getAttribute("data-title")||document.title,r.href),t();break}r=r.parentNode}};return window.addEventListener("popstate",n),document.body.addEventListener("click",r),function(){window.removeEventListener("popstate",n),document.body.removeEventListener("click",r)}},i="undefined"==typeof document?void 0:document,a=!!i&&"content"in i.createElement("template"),u=!!i&&i.createRange&&"createContextualFragment"in i.createRange();function d(e,t){var n=e.nodeName,r=t.nodeName;return n===r||!!(t.actualize&&n.charCodeAt(0)<91&&r.charCodeAt(0)>90)&&n===r.toUpperCase()}function c(e,t,n){e[n]!==t[n]&&(e[n]=t[n],e[n]?e.setAttribute(n,""):e.removeAttribute(n))}var l={OPTION:function(e,t){var n=e.parentNode;if(n){var r=n.nodeName.toUpperCase();"OPTGROUP"===r&&(r=(n=n.parentNode)&&n.nodeName.toUpperCase()),"SELECT"!==r||n.hasAttribute("multiple")||(e.hasAttribute("selected")&&!t.selected&&(e.setAttribute("selected","selected"),e.removeAttribute("selected")),n.selectedIndex=-1)}c(e,t,"selected")},INPUT:function(e,t){c(e,t,"checked"),c(e,t,"disabled"),e.value!==t.value&&(e.value=t.value),t.hasAttribute("value")||e.removeAttribute("value")},TEXTAREA:function(e,t){var n=t.value;e.value!==n&&(e.value=n);var r=e.firstChild;if(r){var o=r.nodeValue;if(o==n||!n&&o==e.placeholder)return;r.nodeValue=n}},SELECT:function(e,t){if(!t.hasAttribute("multiple")){for(var n,r,o=-1,i=0,a=e.firstChild;a;)if("OPTGROUP"===(r=a.nodeName&&a.nodeName.toUpperCase()))a=(n=a).firstChild;else{if("OPTION"===r){if(a.hasAttribute("selected")){o=i;break}i++}!(a=a.nextSibling)&&n&&(a=n.nextSibling,n=null)}e.selectedIndex=o}}},s=1,f=3,m=8;function p(){}function v(e){return e.id}var h,b=(h=function(e,t){var n,r,o,i,a=t.attributes;if(11!==t.nodeType&&11!==e.nodeType){for(var u=0;u<a.length;u++)r=(n=a[u]).name,o=n.namespaceURI,i=n.value,o?(r=n.localName||r,e.getAttributeNS(o,r)!==i&&("xmlns"===n.prefix&&(r=n.name),e.setAttributeNS(o,r,i))):e.getAttribute(r)!==i&&e.setAttribute(r,i);for(var d=e.attributes,c=0;c<d.length;c++)r=(n=d[c]).name,(o=n.namespaceURI)?(r=n.localName||r,t.hasAttributeNS(o,r)||e.removeAttributeNS(o,r)):t.hasAttribute(r)||e.removeAttribute(r)}},function(t,n,r){if(r||(r={}),"string"==typeof n)if("#document"===t.nodeName||"HTML"===t.nodeName){var o=n;(n=i.createElement("html")).innerHTML=o}else c=(c=n).trim(),n=a?function(e){var t=i.createElement("template");return t.innerHTML=e,t.content.childNodes[0]}(c):u?function(t){return e||(e=i.createRange()).selectNode(i.body),e.createContextualFragment(t).childNodes[0]}(c):function(e){var t=i.createElement("body");return t.innerHTML=e,t.childNodes[0]}(c);var c,b=r.getNodeKey||v,N=r.onBeforeNodeAdded||p,g=r.onNodeAdded||p,A=r.onBeforeElUpdated||p,y=r.onElUpdated||p,w=r.onBeforeNodeDiscarded||p,T=r.onNodeDiscarded||p,C=r.onBeforeElChildrenUpdated||p,S=!0===r.childrenOnly,E=Object.create(null),k=[];function O(e){k.push(e)}function x(e,t,n){!1!==w(e)&&(t&&t.removeChild(e),T(e),function e(t,n){if(t.nodeType===s)for(var r=t.firstChild;r;){var o=void 0;n&&(o=b(r))?O(o):(T(r),r.firstChild&&e(r,n)),r=r.nextSibling}}(e,n))}function U(e){g(e);for(var t=e.firstChild;t;){var n=t.nextSibling,r=b(t);if(r){var o=E[r];o&&d(t,o)&&(t.parentNode.replaceChild(o,t),I(o,t))}U(t),t=n}}function I(e,t,n){var r=b(t);if(r&&delete E[r],!n){if(!1===A(e,t))return;if(h(e,t),y(e),!1===C(e,t))return}"TEXTAREA"!==e.nodeName?function(e,t){var n,r,o,a,u,c=t.firstChild,p=e.firstChild;e:for(;c;){for(a=c.nextSibling,n=b(c);p;){if(o=p.nextSibling,c.isSameNode&&c.isSameNode(p)){c=a,p=o;continue e}r=b(p);var v=p.nodeType,h=void 0;if(v===c.nodeType&&(v===s?(n?n!==r&&((u=E[n])?o===u?h=!1:(e.insertBefore(u,p),r?O(r):x(p,e,!0),p=u):h=!1):r&&(h=!1),(h=!1!==h&&d(p,c))&&I(p,c)):v!==f&&v!=m||(h=!0,p.nodeValue!==c.nodeValue&&(p.nodeValue=c.nodeValue))),h){c=a,p=o;continue e}r?O(r):x(p,e,!0),p=o}if(n&&(u=E[n])&&d(u,c))e.appendChild(u),I(u,c);else{var g=N(c);!1!==g&&(g&&(c=g),c.actualize&&(c=c.actualize(e.ownerDocument||i)),e.appendChild(c),U(c))}c=a,p=o}!function(e,t,n){for(;t;){var r=t.nextSibling;(n=b(t))?O(n):x(t,e,!0),t=r}}(e,p,r);var A=l[e.nodeName];A&&A(e,t)}(e,t):l.TEXTAREA(e,t)}!function e(t){if(t.nodeType===s||11===t.nodeType)for(var n=t.firstChild;n;){var r=b(n);r&&(E[r]=n),e(n),n=n.nextSibling}}(t);var R,P,_=t,L=_.nodeType,j=n.nodeType;if(!S)if(L===s)j===s?d(t,n)||(T(t),_=function(e,t){for(var n=e.firstChild;n;){var r=n.nextSibling;t.appendChild(n),n=r}return t}(t,(R=n.nodeName,(P=n.namespaceURI)&&"http://www.w3.org/1999/xhtml"!==P?i.createElementNS(P,R):i.createElement(R)))):_=n;else if(L===f||L===m){if(j===L)return _.nodeValue!==n.nodeValue&&(_.nodeValue=n.nodeValue),_;_=n}if(_===n)T(t);else{if(n.isSameNode&&n.isSameNode(_))return;if(I(_,n,S),k)for(var V=0,M=k.length;V<M;V++){var B=E[k[V]];B&&x(B,B.parentNode,!1)}}return!S&&_!==t&&t.parentNode&&(_.actualize&&(_=_.actualize(t.ownerDocument||i)),t.parentNode.replaceChild(_,t)),_}),N=function(e){return e=e||Object.create(null),{on:function(t,n){(e[t]||(e[t]=[])).push(n)},off:function(t,n){e[t]&&e[t].splice(e[t].indexOf(n)>>>0,1)},emit:function(t,n){(e[t]||[]).slice().map(function(e){e(n)}),(e["*"]||[]).slice().map(function(e){e(t,n)})}}},g={};Object.defineProperty(g,"__esModule",{value:!0}),g.default={onblur:"blur",onchange:"change",oncontextmenu:"contextmenu",onfocus:"focus",oninput:"input",oninvalid:"invalid",onreset:"reset",onsearch:"search",onselect:"select",onsubmit:"submit",onkeydown:"keydown",onkeypress:"keypress",onkeyup:"keyup",onclick:"click",ondblclick:"dblclick",onmousedown:"mousedown",onmousemove:"mousemove",onmouseout:"mouseout",onmouseover:"mouseover",onmouseup:"mouseup",onwheel:"wheel",onanimationend:"animationend",onanimationstart:"animationstart",ondrag:"drag",ondragend:"dragend",ondragenter:"dragenter",ondragexit:"dragexit",ondragleave:"dragleave",ondragover:"dragover",ondragstop:"dragstop",ondrop:"drop"};var A={};function y(e){for(var t in e)A.hasOwnProperty(t)||(A[t]=e[t])}return Object.defineProperty(A,"__esModule",{value:!0}),y(n({})),y(r({})),A});
//# sourceMappingURL=frpuccino.umd.js.map