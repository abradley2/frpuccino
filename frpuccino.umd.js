!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("morphdom"),require("mitt"),require("@most/scheduler"),require("@most/core")):"function"==typeof define&&define.amd?define(["exports","morphdom","mitt","@most/scheduler","@most/core"],n):n(e.frpuccino={},e.morphdom,e.mitt,e.scheduler,e.core)}(this,function(e,n,r,t,o){n=n&&n.hasOwnProperty("default")?n.default:n,r=r&&r.hasOwnProperty("default")?r.default:r;var a={onblur:"blur",onchange:"change",oncontextmenu:"contextmenu",onfocus:"focus",oninput:"input",oninvalid:"invalid",onreset:"reset",onsearch:"search",onselect:"select",onsubmit:"submit",onkeydown:"keydown",onkeypress:"keypress",onkeyup:"keyup",onclick:"click",ondblclick:"dblclick",onmousedown:"mousedown",onmousemove:"mousemove",onmouseout:"mouseout",onmouseover:"mouseover",onmouseup:"mouseup",onwheel:"wheel",onanimationend:"animationend",onanimationstart:"animationstart",ondrag:"drag",ondragend:"dragend",ondragenter:"dragenter",ondragexit:"dragexit",ondragleave:"dragleave",ondragover:"dragover",ondragstop:"dragstop",ondrop:"drop"},i="ACTION";function u(){var e=document.createElement("div");return n(e,Element.prototype.cloneNode.call(this,!0)),e}function c(e){var a=e.mount,u=e.init,c=e.update,d=e.view,s=e.runTasks,l=e.scheduler||t.newDefaultScheduler(),f=r(),p=o.loop(function(e,n){var r,t,a,i=c(e,n.action,l);Array.isArray(i)&&"function"==typeof i[1]?(a=(r=i)[0],t=r[1]):a=i;var u=d(a);return{seed:a,value:{view:u,task:t,eventStream:o.take(1,o.map(function(e){return{action:e}},u.eventStream))}}},u,{run:function(e,n){var r=function(r){return e.event(n.currentTime(),r)};return f.on(i,r),{dispose:function(){f.off(i,r)}}}}),v={event:function(e,r){var u=r.eventStream?null:r;if(u){var c={eventStream:o.now(u)};return this.event.call(this,e,c)}var d=r;if(d.view&&n(a,d.view,{onBeforeElUpdated:m}),d.task&&!1!==s){var p=Array.isArray(d.task)?d.task:[d.task],h=t.newTimeline();p.forEach(function(e){var n=e(v,l);h.add(n)}),h.runTasks(0,function(e){return e.run()})}var g=d.eventStream.run({event:function(e,n){n.time||(n.time=e),f.emit(i,n)},end:function(){g.dispose()},error:function(e,n){throw console.error(n),n}},l)},end:function(){},error:function(e,n){throw console.error(n),n}};return{applicationStream:p,applicationSink:v,scheduler:l,eventSource:f,run:function(e){var n=p.run(v,l);return f.emit(i,{time:l.currentTime(),action:e}),n}}}function d(e,n,r){var t,o;return n&&(n[e]=function(e){t&&t.event(o.currentTime(),e)},n[e].mapFn=r),{run:function(e,n){return t=e,o=n,{dispose:function(){t=void 0}}}}}function m(e,n){return Object.keys(a).forEach(function(r){n[r]?e[r]=n[r]:e[r]&&(e[r]=void 0)}),!0}e.ACTION=i,e.cloneNode=u,e.mapElement=function(e,n){var r=u.call(n);return r.eventStream=o.map(e,function e(n,r){var t=[];Object.keys(a).forEach(function(e){if(r[e]&&r[e].mapFn){var a=r[e].mapFn;t.push(o.map(a,d(e,n,a)))}});for(var i=o.mergeArray(t),u=0;u<n.children.length;u++)i=o.merge(i,e(n.children[u],r.children[u]));return i}(r,n)),r},e.createApplication=c,e.createElement=function(e,n){for(var r=[],t=arguments.length-2;t-- >0;)r[t]=arguments[t+2];var i=document.createElement(e);return i.eventStream=o.empty(),n&&Object.keys(n).forEach(function(e){var r=n[e];if(a[e]&&r){var t=r.constructor===Function?r:function(){return r};i.eventStream=o.merge(i.eventStream,o.map(t,d(e,i,t)))}else-1===["className","id"].indexOf(e)?null!=r&&i.setAttribute(e,r):i[e]=r}),r.forEach(function e(n){if("number"!=typeof n){if(n)if(n&&n.constructor===String){var r=document.createTextNode(n);i.appendChild(r)}else Array.isArray(n)?n.forEach(e):(i.appendChild(n),i.eventStream=o.merge(i.eventStream,n.eventStream),i.cloneNode=u,n.eventStream=null)}else{var t=document.createTextNode(n.toString());i.appendChild(t)}}),i},e.render=function(e,r){0===e.children.length&&e.appendChild(r),n(e.children[0],r,{onBeforeElUpdated:m})},e.record=function(e,n){var r,a=[],u=function(e){!r&&e.time&&(r=e.time-500),a.push(e)};return e.on(i,u),function(d){var m=d.mount,s=d.update,l=d.view,f=d.init;e.off(i,u);var p=t.schedulerRelativeTo(-1*(r-n.currentTime()),n),v=c({view:l,update:s,init:f,mount:m,scheduler:p,runTasks:!1}),h=v.applicationSink,g=v.applicationStream,y=o.mergeArray(a.map(function(e){return o.at(e.time,e)}));o.merge(g,y).run(h,p)}}});
//# sourceMappingURL=frpuccino.umd.js.map
