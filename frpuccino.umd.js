!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).frpuccino=e()}}(function(){var e,t="undefined"==typeof document?void 0:document,n=!!t&&"content"in t.createElement("template"),r=!!t&&t.createRange&&"createContextualFragment"in t.createRange();function o(e,t){var n=e.nodeName,r=t.nodeName;return n===r||!!(t.actualize&&n.charCodeAt(0)<91&&r.charCodeAt(0)>90)&&n===r.toUpperCase()}function i(e,t,n){e[n]!==t[n]&&(e[n]=t[n],e[n]?e.setAttribute(n,""):e.removeAttribute(n))}var a={OPTION:function(e,t){var n=e.parentNode;if(n){var r=n.nodeName.toUpperCase();"OPTGROUP"===r&&(r=(n=n.parentNode)&&n.nodeName.toUpperCase()),"SELECT"!==r||n.hasAttribute("multiple")||(e.hasAttribute("selected")&&!t.selected&&(e.setAttribute("selected","selected"),e.removeAttribute("selected")),n.selectedIndex=-1)}i(e,t,"selected")},INPUT:function(e,t){i(e,t,"checked"),i(e,t,"disabled"),e.value!==t.value&&(e.value=t.value),t.hasAttribute("value")||e.removeAttribute("value")},TEXTAREA:function(e,t){var n=t.value;e.value!==n&&(e.value=n);var r=e.firstChild;if(r){var o=r.nodeValue;if(o==n||!n&&o==e.placeholder)return;r.nodeValue=n}},SELECT:function(e,t){if(!t.hasAttribute("multiple")){for(var n,r,o=-1,i=0,a=e.firstChild;a;)if("OPTGROUP"===(r=a.nodeName&&a.nodeName.toUpperCase()))a=(n=a).firstChild;else{if("OPTION"===r){if(a.hasAttribute("selected")){o=i;break}i++}!(a=a.nextSibling)&&n&&(a=n.nextSibling,n=null)}e.selectedIndex=o}}},u=1,d=3,l=8;function c(){}function s(e){return e.id}var f,m=(f=function(e,t){var n,r,o,i,a=t.attributes;if(11!==t.nodeType&&11!==e.nodeType){for(var u=0;u<a.length;u++)r=(n=a[u]).name,o=n.namespaceURI,i=n.value,o?(r=n.localName||r,e.getAttributeNS(o,r)!==i&&("xmlns"===n.prefix&&(r=n.name),e.setAttributeNS(o,r,i))):e.getAttribute(r)!==i&&e.setAttribute(r,i);for(var d=e.attributes,l=0;l<d.length;l++)r=(n=d[l]).name,(o=n.namespaceURI)?(r=n.localName||r,t.hasAttributeNS(o,r)||e.removeAttributeNS(o,r)):t.hasAttribute(r)||e.removeAttribute(r)}},function(i,m,p){if(p||(p={}),"string"==typeof m)if("#document"===i.nodeName||"HTML"===i.nodeName){var v=m;(m=t.createElement("html")).innerHTML=v}else h=(h=m).trim(),m=n?function(e){var n=t.createElement("template");return n.innerHTML=e,n.content.childNodes[0]}(h):r?function(n){return e||(e=t.createRange()).selectNode(t.body),e.createContextualFragment(n).childNodes[0]}(h):function(e){var n=t.createElement("body");return n.innerHTML=e,n.childNodes[0]}(h);var h,b=p.getNodeKey||s,N=p.onBeforeNodeAdded||c,g=p.onNodeAdded||c,A=p.onBeforeElUpdated||c,y=p.onElUpdated||c,T=p.onBeforeNodeDiscarded||c,S=p.onNodeDiscarded||c,C=p.onBeforeElChildrenUpdated||c,E=!0===p.childrenOnly,w=Object.create(null),O=[];function k(e){O.push(e)}function x(e,t,n){!1!==T(e)&&(t&&t.removeChild(e),S(e),function e(t,n){if(t.nodeType===u)for(var r=t.firstChild;r;){var o=void 0;n&&(o=b(r))?k(o):(S(r),r.firstChild&&e(r,n)),r=r.nextSibling}}(e,n))}function I(e){g(e);for(var t=e.firstChild;t;){var n=t.nextSibling,r=b(t);if(r){var i=w[r];i&&o(t,i)&&(t.parentNode.replaceChild(i,t),U(i,t))}I(t),t=n}}function U(e,n,r){var i=b(n);if(i&&delete w[i],!r){if(!1===A(e,n))return;if(f(e,n),y(e),!1===C(e,n))return}"TEXTAREA"!==e.nodeName?function(e,n){var r,i,c,s,f,m=n.firstChild,p=e.firstChild;e:for(;m;){for(s=m.nextSibling,r=b(m);p;){if(c=p.nextSibling,m.isSameNode&&m.isSameNode(p)){m=s,p=c;continue e}i=b(p);var v=p.nodeType,h=void 0;if(v===m.nodeType&&(v===u?(r?r!==i&&((f=w[r])?c===f?h=!1:(e.insertBefore(f,p),i?k(i):x(p,e,!0),p=f):h=!1):i&&(h=!1),(h=!1!==h&&o(p,m))&&U(p,m)):v!==d&&v!=l||(h=!0,p.nodeValue!==m.nodeValue&&(p.nodeValue=m.nodeValue))),h){m=s,p=c;continue e}i?k(i):x(p,e,!0),p=c}if(r&&(f=w[r])&&o(f,m))e.appendChild(f),U(f,m);else{var g=N(m);!1!==g&&(g&&(m=g),m.actualize&&(m=m.actualize(e.ownerDocument||t)),e.appendChild(m),I(m))}m=s,p=c}!function(e,t,n){for(;t;){var r=t.nextSibling;(n=b(t))?k(n):x(t,e,!0),t=r}}(e,p,i);var A=a[e.nodeName];A&&A(e,n)}(e,n):a.TEXTAREA(e,n)}!function e(t){if(t.nodeType===u||11===t.nodeType)for(var n=t.firstChild;n;){var r=b(n);r&&(w[r]=n),e(n),n=n.nextSibling}}(i);var P,R,_=i,j=_.nodeType,V=m.nodeType;if(!E)if(j===u)V===u?o(i,m)||(S(i),_=function(e,t){for(var n=e.firstChild;n;){var r=n.nextSibling;t.appendChild(n),n=r}return t}(i,(P=m.nodeName,(R=m.namespaceURI)&&"http://www.w3.org/1999/xhtml"!==R?t.createElementNS(R,P):t.createElement(P)))):_=m;else if(j===d||j===l){if(V===j)return _.nodeValue!==m.nodeValue&&(_.nodeValue=m.nodeValue),_;_=m}if(_===m)S(i);else{if(m.isSameNode&&m.isSameNode(_))return;if(U(_,m,E),O)for(var M=0,B=O.length;M<B;M++){var D=w[O[M]];D&&x(D,D.parentNode,!1)}}return!E&&_!==i&&i.parentNode&&(_.actualize&&(_=_.actualize(i.ownerDocument||t)),i.parentNode.replaceChild(_,i)),_}),p={};Object.defineProperty(p,"__esModule",{value:!0}),p.default={onblur:"blur",onchange:"change",oncontextmenu:"contextmenu",onfocus:"focus",oninput:"input",oninvalid:"invalid",onreset:"reset",onsearch:"search",onselect:"select",onsubmit:"submit",onkeydown:"keydown",onkeypress:"keypress",onkeyup:"keyup",onclick:"click",ondblclick:"dblclick",onmousedown:"mousedown",onmousemove:"mousemove",onmouseout:"mouseout",onmouseover:"mouseover",onmouseup:"mouseup",onwheel:"wheel",onanimationend:"animationend",onanimationstart:"animationstart",ondrag:"drag",ondragend:"dragend",ondragenter:"dragenter",ondragexit:"dragexit",ondragleave:"dragleave",ondragover:"dragover",ondragstop:"dragstop",ondrop:"drop"};var v={},h=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(v,"__esModule",{value:!0});const b=require("@most/core"),N=h(m),g=h(function(e){return e=e||Object.create(null),{on:function(t,n){(e[t]||(e[t]=[])).push(n)},off:function(t,n){e[t]&&e[t].splice(e[t].indexOf(n)>>>0,1)},emit:function(t,n){(e[t]||[]).slice().map(function(e){e(n)}),(e["*"]||[]).slice().map(function(e){e(t,n)})}}}),A=require("@most/scheduler"),y=h(p);function T(e){if(!1===e)throw new Error("StreamElement cannot be shallow cloned");const t=document.createElement("div");return N.default(t,Element.prototype.cloneNode.call(this,!0)),t}function S(e,t,n){let r,o;return t&&(t[e]=(e=>{r&&r.event(o.currentTime(),e)}),t[e].mapFn=n),{run:(e,t)=>(r=e,o=t,{dispose:()=>{r=void 0}})}}function C(e,t){return Object.keys(y.default).forEach(n=>{t[n]?e[n]=t[n]:e[n]&&(e[n]=void 0)}),!0}v.ACTION="ACTION",v.cloneNode=T,v.mapElement=function(e,t){const n=T.call(t);return n.eventStream=b.map(e,function e(t,n){const r=[];Object.keys(y.default).forEach(e=>{if(n[e]&&n[e].mapFn){const o=n[e].mapFn;r.push(b.map(o,S(e,t,o)))}});let o=b.mergeArray(r);for(let i=0;i<t.children.length;i++){const r=t.children[i],a=n.children[i];o=b.merge(o,e(r,a))}return o}(n,t)),n},v.createApplication=function(e){const{mount:t,init:n,update:r,view:o,runTasks:i}=e,a=e.scheduler||A.newDefaultScheduler(),u=g.default(),d={run:(e,t)=>{const n=n=>e.event(t.currentTime(),n);return u.on(v.ACTION,n),{dispose:()=>{u.off(v.ACTION,n)}}}},l=b.loop((e,t)=>{let n,i;const u=r(e,t.action,a);Array.isArray(u)?[i,n]=u:i=u;const d=o(i);return{seed:i,value:{view:d,task:n,eventStream:b.take(1,b.map(e=>({action:e}),d.eventStream))}}},n,d),c={event:function(e,n){const r=n.eventStream?null:n;if(r){const t={eventStream:b.now(r)};return this.event(e,t)}const o=n;if(o.view&&N.default(t,o.view,{onBeforeElUpdated:C}),o.task&&!1!==i){const e=Array.isArray(o.task)?o.task:[o.task],t=A.newTimeline();e.forEach(e=>{const n=e(c,a);t.add(n)}),t.runTasks(0,e=>e.run())}const d=o.eventStream.run({event:(e,t)=>{t.time||(t.time=e),u.emit(v.ACTION,t)},end:()=>{d.dispose()},error:(e,t)=>{throw console.error(t),t}},a)},end:()=>{},error:(e,t)=>{throw console.error(t),t}};return{applicationStream:l,applicationSink:c,scheduler:a,eventSource:u,run:e=>{const t=l.run(c,a);return u.emit(v.ACTION,{time:a.currentTime(),action:e}),t}}},v.createElement=function(e,t,...n){const r=document.createElement(e);return r.eventStream=b.empty(),t&&Object.keys(t).forEach(function(e){const n=t[e];if(y.default[e]&&n){const t=n.constructor===Function?n:()=>n;r.eventStream=b.merge(r.eventStream,b.map(t,S(e,r,t)))}else-1===["className","id"].indexOf(e)?null!=n&&r.setAttribute(e,n):r[e]=n}),n.forEach(function e(t){if("number"!=typeof t){if(t)if(t&&t.constructor===String){const e=document.createTextNode(t);r.appendChild(e)}else Array.isArray(t)?t.forEach(e):(r.appendChild(t),r.eventStream=b.merge(r.eventStream,t.eventStream),r.cloneNode=T,t.eventStream=null)}else{const e=document.createTextNode(t.toString());r.appendChild(e)}}),r},v.render=function(e,t){0===e.children.length&&e.appendChild(t);const n=e.children[0];N.default(n,t,{onBeforeElUpdated:C})};var E={};Object.defineProperty(E,"__esModule",{value:!0});const w=require("@most/scheduler"),O=require("@most/core");E.record=function(e,t){let n;const r=[],o=e=>{!n&&e.time&&(n=e.time-500),r.push(e)};return e.on(v.ACTION,o),function({mount:i,update:a,view:u,init:d}){e.off(v.ACTION,o);const l=w.schedulerRelativeTo(-1*(n-t.currentTime()),t),{applicationSink:c,applicationStream:s}=v.createApplication({view:u,update:a,init:d,mount:i,scheduler:l,runTasks:!1}),f=O.mergeArray(r.map(e=>O.at(e.time,e)));O.merge(s,f).run(c,l)}};var k={};function x(e){for(var t in e)k.hasOwnProperty(t)||(k[t]=e[t])}return Object.defineProperty(k,"__esModule",{value:!0}),x(v),x(E),k});
//# sourceMappingURL=frpuccino.umd.js.map