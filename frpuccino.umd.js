!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).frpuccino=e()}}(function(){var e,t=function(e){var t;return function(n){return t||e(t={exports:{},parent:n},t.exports),t.exports}},n=t(function(e,t){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=n(o),i=require("@most/core"),u=n(b),c=n(g),d=require("@most/scheduler"),l=n(N),s=r({});function f(e){if(!1===e)throw new Error("StreamElement cannot be shallow cloned");const t=document.createElement("div");return u.default(t,Element.prototype.cloneNode.call(this,!0)),t}function m(e,t){return p(t).map(e).createTask}function p(e){return{createTask:e,map:function(t){return p((n,r)=>e({event:(e,r)=>{r.action&&n.event(e,{action:t(r.action)}),r.eventStream&&n.event(e,{eventStream:i.map(e=>({action:t(e.action)}),r.eventStream)})},end:e=>{n.end(e)},error:(e,t)=>{n.error(e,t)}},r))}}}let v;function h(e,t,n){let r,o;return t&&(t[e]=(e=>{r&&r.event(o.currentTime(),e)}),t[e].mapFn=n),{run:(e,t)=>(r=e,o=t,{dispose:()=>{r=void 0}})}}function A(e,t){return Object.keys(l.default).forEach(n=>{t[n]?e[n]=t[n]:e[n]&&(e[n]=void 0)}),!0}t.ACTION="ACTION",t.cloneNode=f,t.mapElement=function(e,t){const n=f.call(t);return n.eventStream=i.map(e,function e(t,n){const r=[];Object.keys(l.default).forEach(e=>{if(n[e]&&n[e].mapFn){const o=n[e].mapFn;r.push(i.map(o,h(e,t,o)))}});let o=i.mergeArray(r);for(let a=0;a<t.children.length;a++){const r=t.children[a],u=n.children[a];o=i.merge(o,e(r,u))}return o}(n,t)),n},t.mapTaskCreator=m,t.taskGenerator=p,t.mapUpdateResult=function(e,t,n){const[r,o]=Array.isArray(n)?n:[n,null],a=(Array.isArray(o)?o:[o]).filter(e=>!!e).map(e=>m(t,e));return[e(r),a]},t.createApplication=function(e){const{mount:n,init:r,update:o,view:l,runTasks:f,mapUrlChange:m}=e,p=e.scheduler||d.newDefaultScheduler(),h=c.default(),b=()=>{h.emit(t.ACTION,{action:m(window.location),time:p.currentTime()})};m&&(window.addEventListener("urlchange",b),v||(a.default(),v=!0));const g={run:(n,r)=>{const o=e=>n.event(r.currentTime(),e);return h.on(t.ACTION,o),{dispose:()=>{h.off(t.ACTION,o),e.mapUrlChange&&h.off(t.ACTION,b)}}}};let N=i.loop((e,t)=>{let n,r;const a=o(e,t.action,p);Array.isArray(a)?[r,n]=a:r=a;const u=l(r);return{seed:r,value:{view:u,task:n,eventStream:i.take(1,i.map(e=>({action:e}),u.eventStream))}}},r,g);m&&(N=i.startWith({eventStream:i.now({action:m(window.location)})},N));const y={event:function(e,r){const o=r.eventStream?null:r;if(o){const t={eventStream:i.now(o)};return this.event(e,t)}const a=r;if(a.view&&u.default(n,a.view,{onBeforeElUpdated:A}),a.task&&!1!==f){const e=Array.isArray(a.task)?a.task:[a.task],t=d.newTimeline();e.forEach(e=>{const n=e(y,p);t.add(n)}),t.runTasks(0,e=>e.run())}const c=a.eventStream.run({event:(e,n)=>{n.time||(n.time=e),h.emit(t.ACTION,n)},end:()=>{c.dispose()},error:(e,t)=>{throw console.error(t),t}},p)},end:()=>{},error:(e,t)=>{throw console.error(t),t}};return{applicationStream:N,applicationSink:y,scheduler:p,eventSource:h,run:e=>{const n=N.run(y,p);return h.emit(t.ACTION,{time:p.currentTime(),action:e}),n},record:()=>{const e=s.record(h,p);return t=>e(t)}}},t.createElement=function(e,t,...n){const r=document.createElement(e);return r.eventStream=i.empty(),t&&Object.keys(t).forEach(function(e){const n=t[e];if(l.default[e]&&n){const t=n.constructor===Function?n:()=>n;r.eventStream=i.merge(r.eventStream,i.map(t,h(e,r,t)))}else-1===["className","id"].indexOf(e)?null!=n&&r.setAttribute(e,n):r[e]=n}),n.forEach(function e(t){if("number"!=typeof t){if(t)if(t&&t.constructor===String){const e=document.createTextNode(t);r.appendChild(e)}else Array.isArray(t)?t.forEach(e):(r.appendChild(t),r.eventStream=i.merge(r.eventStream,t.eventStream),r.cloneNode=f,t.eventStream=null)}else{const e=document.createTextNode(t.toString());r.appendChild(e)}}),r},t.render=function(e,t){0===e.children.length&&e.appendChild(t);const n=e.children[0];u.default(n,t,{onBeforeElUpdated:A})}}),r=t(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n({}),o=require("@most/scheduler"),a=require("@most/core");t.record=function(e,t){let n;const i=[],u=e=>{!n&&e.time&&(n=e.time-500),i.push(e)};return e.on(r.ACTION,u),function(c){const{mount:d,update:l,view:s,init:f,mapUrlChange:m}=c;e.off(r.ACTION,u);const p=o.schedulerRelativeTo(-1*(n-t.currentTime()),t),v=r.createApplication({view:s,update:l,init:f,mount:d,mapUrlChange:m,scheduler:p,runTasks:!1}),{applicationSink:h,applicationStream:b}=v,g=a.mergeArray(i.map(e=>a.now({action:e.action})));return{application:v,run:()=>a.merge(b,g).run(h,p)}}}}),o=function(e){const t=()=>{const e=new window.CustomEvent("urlchange",{detail:document.location});window.dispatchEvent(e)},n=()=>{t()},r=n=>{let r=n.target;for(;r!==document.body;){if("A"===r.nodeName.toUpperCase()){const o=r.getAttribute("data-link");if("replaceState"!==o&&"pushState"!==o)break;n.preventDefault(),window.history[o](e?e(r):window.history.state,r.getAttribute("data-title")||document.title,r.href),t();break}r=r.parentNode}};return window.addEventListener("popstate",n),document.body.addEventListener("click",r),function(){window.removeEventListener("popstate",n),document.body.removeEventListener("click",r)}},a="undefined"==typeof document?void 0:document,i=!!a&&"content"in a.createElement("template"),u=!!a&&a.createRange&&"createContextualFragment"in a.createRange();function c(e,t){var n=e.nodeName,r=t.nodeName;return n===r||!!(t.actualize&&n.charCodeAt(0)<91&&r.charCodeAt(0)>90)&&n===r.toUpperCase()}function d(e,t,n){e[n]!==t[n]&&(e[n]=t[n],e[n]?e.setAttribute(n,""):e.removeAttribute(n))}var l={OPTION:function(e,t){var n=e.parentNode;if(n){var r=n.nodeName.toUpperCase();"OPTGROUP"===r&&(r=(n=n.parentNode)&&n.nodeName.toUpperCase()),"SELECT"!==r||n.hasAttribute("multiple")||(e.hasAttribute("selected")&&!t.selected&&(e.setAttribute("selected","selected"),e.removeAttribute("selected")),n.selectedIndex=-1)}d(e,t,"selected")},INPUT:function(e,t){d(e,t,"checked"),d(e,t,"disabled"),e.value!==t.value&&(e.value=t.value),t.hasAttribute("value")||e.removeAttribute("value")},TEXTAREA:function(e,t){var n=t.value;e.value!==n&&(e.value=n);var r=e.firstChild;if(r){var o=r.nodeValue;if(o==n||!n&&o==e.placeholder)return;r.nodeValue=n}},SELECT:function(e,t){if(!t.hasAttribute("multiple")){for(var n,r,o=-1,a=0,i=e.firstChild;i;)if("OPTGROUP"===(r=i.nodeName&&i.nodeName.toUpperCase()))i=(n=i).firstChild;else{if("OPTION"===r){if(i.hasAttribute("selected")){o=a;break}a++}!(i=i.nextSibling)&&n&&(i=n.nextSibling,n=null)}e.selectedIndex=o}}},s=1,f=3,m=8;function p(){}function v(e){return e.id}var h,b=(h=function(e,t){var n,r,o,a,i=t.attributes;if(11!==t.nodeType&&11!==e.nodeType){for(var u=0;u<i.length;u++)r=(n=i[u]).name,o=n.namespaceURI,a=n.value,o?(r=n.localName||r,e.getAttributeNS(o,r)!==a&&("xmlns"===n.prefix&&(r=n.name),e.setAttributeNS(o,r,a))):e.getAttribute(r)!==a&&e.setAttribute(r,a);for(var c=e.attributes,d=0;d<c.length;d++)r=(n=c[d]).name,(o=n.namespaceURI)?(r=n.localName||r,t.hasAttributeNS(o,r)||e.removeAttributeNS(o,r)):t.hasAttribute(r)||e.removeAttribute(r)}},function(t,n,r){if(r||(r={}),"string"==typeof n)if("#document"===t.nodeName||"HTML"===t.nodeName){var o=n;(n=a.createElement("html")).innerHTML=o}else d=(d=n).trim(),n=i?function(e){var t=a.createElement("template");return t.innerHTML=e,t.content.childNodes[0]}(d):u?function(t){return e||(e=a.createRange()).selectNode(a.body),e.createContextualFragment(t).childNodes[0]}(d):function(e){var t=a.createElement("body");return t.innerHTML=e,t.childNodes[0]}(d);var d,b=r.getNodeKey||v,g=r.onBeforeNodeAdded||p,N=r.onNodeAdded||p,A=r.onBeforeElUpdated||p,y=r.onElUpdated||p,w=r.onBeforeNodeDiscarded||p,T=r.onNodeDiscarded||p,C=r.onBeforeElChildrenUpdated||p,S=!0===r.childrenOnly,E=Object.create(null),k=[];function O(e){k.push(e)}function x(e,t,n){!1!==w(e)&&(t&&t.removeChild(e),T(e),function e(t,n){if(t.nodeType===s)for(var r=t.firstChild;r;){var o=void 0;n&&(o=b(r))?O(o):(T(r),r.firstChild&&e(r,n)),r=r.nextSibling}}(e,n))}function U(e){N(e);for(var t=e.firstChild;t;){var n=t.nextSibling,r=b(t);if(r){var o=E[r];o&&c(t,o)&&(t.parentNode.replaceChild(o,t),I(o,t))}U(t),t=n}}function I(e,t,n){var r=b(t);if(r&&delete E[r],!n){if(!1===A(e,t))return;if(h(e,t),y(e),!1===C(e,t))return}"TEXTAREA"!==e.nodeName?function(e,t){var n,r,o,i,u,d=t.firstChild,p=e.firstChild;e:for(;d;){for(i=d.nextSibling,n=b(d);p;){if(o=p.nextSibling,d.isSameNode&&d.isSameNode(p)){d=i,p=o;continue e}r=b(p);var v=p.nodeType,h=void 0;if(v===d.nodeType&&(v===s?(n?n!==r&&((u=E[n])?o===u?h=!1:(e.insertBefore(u,p),r?O(r):x(p,e,!0),p=u):h=!1):r&&(h=!1),(h=!1!==h&&c(p,d))&&I(p,d)):v!==f&&v!=m||(h=!0,p.nodeValue!==d.nodeValue&&(p.nodeValue=d.nodeValue))),h){d=i,p=o;continue e}r?O(r):x(p,e,!0),p=o}if(n&&(u=E[n])&&c(u,d))e.appendChild(u),I(u,d);else{var N=g(d);!1!==N&&(N&&(d=N),d.actualize&&(d=d.actualize(e.ownerDocument||a)),e.appendChild(d),U(d))}d=i,p=o}!function(e,t,n){for(;t;){var r=t.nextSibling;(n=b(t))?O(n):x(t,e,!0),t=r}}(e,p,r);var A=l[e.nodeName];A&&A(e,t)}(e,t):l.TEXTAREA(e,t)}!function e(t){if(t.nodeType===s||11===t.nodeType)for(var n=t.firstChild;n;){var r=b(n);r&&(E[r]=n),e(n),n=n.nextSibling}}(t);var R,P,_=t,L=_.nodeType,j=n.nodeType;if(!S)if(L===s)j===s?c(t,n)||(T(t),_=function(e,t){for(var n=e.firstChild;n;){var r=n.nextSibling;t.appendChild(n),n=r}return t}(t,(R=n.nodeName,(P=n.namespaceURI)&&"http://www.w3.org/1999/xhtml"!==P?a.createElementNS(P,R):a.createElement(R)))):_=n;else if(L===f||L===m){if(j===L)return _.nodeValue!==n.nodeValue&&(_.nodeValue=n.nodeValue),_;_=n}if(_===n)T(t);else{if(n.isSameNode&&n.isSameNode(_))return;if(I(_,n,S),k)for(var V=0,M=k.length;V<M;V++){var B=E[k[V]];B&&x(B,B.parentNode,!1)}}return!S&&_!==t&&t.parentNode&&(_.actualize&&(_=_.actualize(t.ownerDocument||a)),t.parentNode.replaceChild(_,t)),_}),g=function(e){return e=e||Object.create(null),{on:function(t,n){(e[t]||(e[t]=[])).push(n)},off:function(t,n){e[t]&&e[t].splice(e[t].indexOf(n)>>>0,1)},emit:function(t,n){(e[t]||[]).slice().map(function(e){e(n)}),(e["*"]||[]).slice().map(function(e){e(t,n)})}}},N={};Object.defineProperty(N,"__esModule",{value:!0}),N.default={onblur:"blur",onchange:"change",oncontextmenu:"contextmenu",onfocus:"focus",oninput:"input",oninvalid:"invalid",onreset:"reset",onsearch:"search",onselect:"select",onsubmit:"submit",onkeydown:"keydown",onkeypress:"keypress",onkeyup:"keyup",onclick:"click",ondblclick:"dblclick",onmousedown:"mousedown",onmousemove:"mousemove",onmouseout:"mouseout",onmouseover:"mouseover",onmouseup:"mouseup",onwheel:"wheel",onanimationend:"animationend",onanimationstart:"animationstart",ondrag:"drag",ondragend:"dragend",ondragenter:"dragenter",ondragexit:"dragexit",ondragleave:"dragleave",ondragover:"dragover",ondragstop:"dragstop",ondrop:"drop"};var A={};function y(e){for(var t in e)A.hasOwnProperty(t)||(A[t]=e[t])}return Object.defineProperty(A,"__esModule",{value:!0}),y(n({})),y(r({})),A});
//# sourceMappingURL=frpuccino.umd.js.map