!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).frpuccino=e()}}(function(){var e,t=function(e){var t;return function(n){return t||e(t={exports:{},parent:n},t.exports),t.exports}},n=t(function(e,t){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=require("@most/core"),i=n(h),a=n(N),u=require("@most/scheduler"),c=n(A),d=r({});function l(e){if(!1===e)throw new Error("StreamElement cannot be shallow cloned");const t=document.createElement("div");return i.default(t,Element.prototype.cloneNode.call(this,!0)),t}function s(e,t){return f(t).map(e).createTask}function f(e){return{createTask:e,map:function(t){return f((n,r)=>e({event:(e,r)=>{n.event(e,{action:t(r.action)})},end:e=>{n.end(e)},error:(e,t)=>{n.error(e,t)}},r))}}}function m(e,t,n){let r,o;return t&&(t[e]=(e=>{r&&r.event(o.currentTime(),e)}),t[e].mapFn=n),{run:(e,t)=>(r=e,o=t,{dispose:()=>{r=void 0}})}}function p(e,t){return Object.keys(c.default).forEach(n=>{t[n]?e[n]=t[n]:e[n]&&(e[n]=void 0)}),!0}t.ACTION="ACTION",t.cloneNode=l,t.mapElement=function(e,t){const n=l.call(t);return n.eventStream=o.map(e,function e(t,n){const r=[];Object.keys(c.default).forEach(e=>{if(n[e]&&n[e].mapFn){const i=n[e].mapFn;r.push(o.map(i,m(e,t,i)))}});let i=o.mergeArray(r);for(let a=0;a<t.children.length;a++){const r=t.children[a],u=n.children[a];i=o.merge(i,e(r,u))}return i}(n,t)),n},t.mapTaskCreator=s,t.taskGenerator=f,t.mapUpdateResult=function(e,t,n){const[r,o]=Array.isArray(n)?n:[n,null],i=(Array.isArray(o)?o:[o]).filter(e=>!!e).map(e=>s(t,e));return[e(r),i]},t.createApplication=function(e){const{mount:n,init:r,update:c,view:l,runTasks:s}=e,f=e.scheduler||u.newDefaultScheduler(),m=a.default(),v={run:(e,n)=>{const r=t=>e.event(n.currentTime(),t);return m.on(t.ACTION,r),{dispose:()=>{m.off(t.ACTION,r)}}}},h=o.loop((e,t)=>{let n,r;const i=c(e,t.action,f);Array.isArray(i)?[r,n]=i:r=i;const a=l(r);return{seed:r,value:{view:a,task:n,eventStream:o.take(1,o.map(e=>({action:e}),a.eventStream))}}},r,v),N={event:function(e,r){const a=r.eventStream?null:r;if(a){const t={eventStream:o.now(a)};return this.event(e,t)}const c=r;if(c.view&&i.default(n,c.view,{onBeforeElUpdated:p}),c.task&&!1!==s){const e=Array.isArray(c.task)?c.task:[c.task],t=u.newTimeline();e.forEach(e=>{const n=e(N,f);t.add(n)}),t.runTasks(0,e=>e.run())}const d=c.eventStream.run({event:(e,n)=>{n.time||(n.time=e),m.emit(t.ACTION,n)},end:()=>{d.dispose()},error:(e,t)=>{throw console.error(t),t}},f)},end:()=>{},error:(e,t)=>{throw console.error(t),t}};let A;return{applicationStream:h,applicationSink:N,scheduler:f,eventSource:m,run:e=>(A=h.run(N,f),m.emit(t.ACTION,{time:f.currentTime(),action:e}),A),record:()=>{const e=d.record(m,f);return t=>(A.dispose(),e(t))}}},t.createElement=function(e,t,...n){const r=document.createElement(e);return r.eventStream=o.empty(),t&&Object.keys(t).forEach(function(e){const n=t[e];if(c.default[e]&&n){const t=n.constructor===Function?n:()=>n;r.eventStream=o.merge(r.eventStream,o.map(t,m(e,r,t)))}else-1===["className","id"].indexOf(e)?null!=n&&r.setAttribute(e,n):r[e]=n}),n.forEach(function e(t){if("number"!=typeof t){if(t)if(t&&t.constructor===String){const e=document.createTextNode(t);r.appendChild(e)}else Array.isArray(t)?t.forEach(e):(r.appendChild(t),r.eventStream=o.merge(r.eventStream,t.eventStream),r.cloneNode=l,t.eventStream=null)}else{const e=document.createTextNode(t.toString());r.appendChild(e)}}),r},t.render=function(e,t){0===e.children.length&&e.appendChild(t);const n=e.children[0];i.default(n,t,{onBeforeElUpdated:p})}}),r=t(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n({}),o=require("@most/scheduler"),i=require("@most/core");t.record=function(e,t){let n;const a=[],u=e=>{!n&&e.time&&(n=e.time-500),a.push(e)};return e.on(r.ACTION,u),function({mount:c,update:d,view:l,init:s}){e.off(r.ACTION,u);const f=o.schedulerRelativeTo(-1*(n-t.currentTime()),t),m=r.createApplication({view:l,update:d,init:s,mount:c,scheduler:f,runTasks:!1}),{applicationSink:p,applicationStream:v}=m,h=i.mergeArray(a.map(e=>i.at(e.time,e)));return i.merge(v,h).run(p,f),console.log("RETURNING APPLICATION FROM PLAYBACK",m),m}}}),o="undefined"==typeof document?void 0:document,i=!!o&&"content"in o.createElement("template"),a=!!o&&o.createRange&&"createContextualFragment"in o.createRange();function u(e,t){var n=e.nodeName,r=t.nodeName;return n===r||!!(t.actualize&&n.charCodeAt(0)<91&&r.charCodeAt(0)>90)&&n===r.toUpperCase()}function c(e,t,n){e[n]!==t[n]&&(e[n]=t[n],e[n]?e.setAttribute(n,""):e.removeAttribute(n))}var d={OPTION:function(e,t){var n=e.parentNode;if(n){var r=n.nodeName.toUpperCase();"OPTGROUP"===r&&(r=(n=n.parentNode)&&n.nodeName.toUpperCase()),"SELECT"!==r||n.hasAttribute("multiple")||(e.hasAttribute("selected")&&!t.selected&&(e.setAttribute("selected","selected"),e.removeAttribute("selected")),n.selectedIndex=-1)}c(e,t,"selected")},INPUT:function(e,t){c(e,t,"checked"),c(e,t,"disabled"),e.value!==t.value&&(e.value=t.value),t.hasAttribute("value")||e.removeAttribute("value")},TEXTAREA:function(e,t){var n=t.value;e.value!==n&&(e.value=n);var r=e.firstChild;if(r){var o=r.nodeValue;if(o==n||!n&&o==e.placeholder)return;r.nodeValue=n}},SELECT:function(e,t){if(!t.hasAttribute("multiple")){for(var n,r,o=-1,i=0,a=e.firstChild;a;)if("OPTGROUP"===(r=a.nodeName&&a.nodeName.toUpperCase()))a=(n=a).firstChild;else{if("OPTION"===r){if(a.hasAttribute("selected")){o=i;break}i++}!(a=a.nextSibling)&&n&&(a=n.nextSibling,n=null)}e.selectedIndex=o}}},l=1,s=3,f=8;function m(){}function p(e){return e.id}var v,h=(v=function(e,t){var n,r,o,i,a=t.attributes;if(11!==t.nodeType&&11!==e.nodeType){for(var u=0;u<a.length;u++)r=(n=a[u]).name,o=n.namespaceURI,i=n.value,o?(r=n.localName||r,e.getAttributeNS(o,r)!==i&&("xmlns"===n.prefix&&(r=n.name),e.setAttributeNS(o,r,i))):e.getAttribute(r)!==i&&e.setAttribute(r,i);for(var c=e.attributes,d=0;d<c.length;d++)r=(n=c[d]).name,(o=n.namespaceURI)?(r=n.localName||r,t.hasAttributeNS(o,r)||e.removeAttributeNS(o,r)):t.hasAttribute(r)||e.removeAttribute(r)}},function(t,n,r){if(r||(r={}),"string"==typeof n)if("#document"===t.nodeName||"HTML"===t.nodeName){var c=n;(n=o.createElement("html")).innerHTML=c}else h=(h=n).trim(),n=i?function(e){var t=o.createElement("template");return t.innerHTML=e,t.content.childNodes[0]}(h):a?function(t){return e||(e=o.createRange()).selectNode(o.body),e.createContextualFragment(t).childNodes[0]}(h):function(e){var t=o.createElement("body");return t.innerHTML=e,t.childNodes[0]}(h);var h,N=r.getNodeKey||p,A=r.onBeforeNodeAdded||m,b=r.onNodeAdded||m,g=r.onBeforeElUpdated||m,y=r.onElUpdated||m,T=r.onBeforeNodeDiscarded||m,C=r.onNodeDiscarded||m,S=r.onBeforeElChildrenUpdated||m,E=!0===r.childrenOnly,w=Object.create(null),O=[];function k(e){O.push(e)}function x(e,t,n){!1!==T(e)&&(t&&t.removeChild(e),C(e),function e(t,n){if(t.nodeType===l)for(var r=t.firstChild;r;){var o=void 0;n&&(o=N(r))?k(o):(C(r),r.firstChild&&e(r,n)),r=r.nextSibling}}(e,n))}function I(e){b(e);for(var t=e.firstChild;t;){var n=t.nextSibling,r=N(t);if(r){var o=w[r];o&&u(t,o)&&(t.parentNode.replaceChild(o,t),U(o,t))}I(t),t=n}}function U(e,t,n){var r=N(t);if(r&&delete w[r],!n){if(!1===g(e,t))return;if(v(e,t),y(e),!1===S(e,t))return}"TEXTAREA"!==e.nodeName?function(e,t){var n,r,i,a,c,m=t.firstChild,p=e.firstChild;e:for(;m;){for(a=m.nextSibling,n=N(m);p;){if(i=p.nextSibling,m.isSameNode&&m.isSameNode(p)){m=a,p=i;continue e}r=N(p);var v=p.nodeType,h=void 0;if(v===m.nodeType&&(v===l?(n?n!==r&&((c=w[n])?i===c?h=!1:(e.insertBefore(c,p),r?k(r):x(p,e,!0),p=c):h=!1):r&&(h=!1),(h=!1!==h&&u(p,m))&&U(p,m)):v!==s&&v!=f||(h=!0,p.nodeValue!==m.nodeValue&&(p.nodeValue=m.nodeValue))),h){m=a,p=i;continue e}r?k(r):x(p,e,!0),p=i}if(n&&(c=w[n])&&u(c,m))e.appendChild(c),U(c,m);else{var b=A(m);!1!==b&&(b&&(m=b),m.actualize&&(m=m.actualize(e.ownerDocument||o)),e.appendChild(m),I(m))}m=a,p=i}!function(e,t,n){for(;t;){var r=t.nextSibling;(n=N(t))?k(n):x(t,e,!0),t=r}}(e,p,r);var g=d[e.nodeName];g&&g(e,t)}(e,t):d.TEXTAREA(e,t)}!function e(t){if(t.nodeType===l||11===t.nodeType)for(var n=t.firstChild;n;){var r=N(n);r&&(w[r]=n),e(n),n=n.nextSibling}}(t);var R,P,_=t,j=_.nodeType,M=n.nodeType;if(!E)if(j===l)M===l?u(t,n)||(C(t),_=function(e,t){for(var n=e.firstChild;n;){var r=n.nextSibling;t.appendChild(n),n=r}return t}(t,(R=n.nodeName,(P=n.namespaceURI)&&"http://www.w3.org/1999/xhtml"!==P?o.createElementNS(P,R):o.createElement(R)))):_=n;else if(j===s||j===f){if(M===j)return _.nodeValue!==n.nodeValue&&(_.nodeValue=n.nodeValue),_;_=n}if(_===n)C(t);else{if(n.isSameNode&&n.isSameNode(_))return;if(U(_,n,E),O)for(var V=0,B=O.length;V<B;V++){var L=w[O[V]];L&&x(L,L.parentNode,!1)}}return!E&&_!==t&&t.parentNode&&(_.actualize&&(_=_.actualize(t.ownerDocument||o)),t.parentNode.replaceChild(_,t)),_}),N=function(e){return e=e||Object.create(null),{on:function(t,n){(e[t]||(e[t]=[])).push(n)},off:function(t,n){e[t]&&e[t].splice(e[t].indexOf(n)>>>0,1)},emit:function(t,n){(e[t]||[]).slice().map(function(e){e(n)}),(e["*"]||[]).slice().map(function(e){e(t,n)})}}},A={};Object.defineProperty(A,"__esModule",{value:!0}),A.default={onblur:"blur",onchange:"change",oncontextmenu:"contextmenu",onfocus:"focus",oninput:"input",oninvalid:"invalid",onreset:"reset",onsearch:"search",onselect:"select",onsubmit:"submit",onkeydown:"keydown",onkeypress:"keypress",onkeyup:"keyup",onclick:"click",ondblclick:"dblclick",onmousedown:"mousedown",onmousemove:"mousemove",onmouseout:"mouseout",onmouseover:"mouseover",onmouseup:"mouseup",onwheel:"wheel",onanimationend:"animationend",onanimationstart:"animationstart",ondrag:"drag",ondragend:"dragend",ondragenter:"dragenter",ondragexit:"dragexit",ondragleave:"dragleave",ondragover:"dragover",ondragstop:"dragstop",ondrop:"drop"};var b={};function g(e){for(var t in e)b.hasOwnProperty(t)||(b[t]=e[t])}return Object.defineProperty(b,"__esModule",{value:!0}),g(n({})),g(r({})),b});
//# sourceMappingURL=frpuccino.umd.js.map