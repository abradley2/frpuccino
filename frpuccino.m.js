import e from"morphdom";import n from"mitt";import{newDefaultScheduler as t,newTimeline as r,schedulerRelativeTo as o}from"@most/scheduler";import{loop as i,empty as a,merge as u,mergeArray as c,map as d,take as m,now as s,at as l}from"@most/core";var v={onblur:"blur",onchange:"change",oncontextmenu:"contextmenu",onfocus:"focus",oninput:"input",oninvalid:"invalid",onreset:"reset",onsearch:"search",onselect:"select",onsubmit:"submit",onkeydown:"keydown",onkeypress:"keypress",onkeyup:"keyup",onclick:"click",ondblclick:"dblclick",onmousedown:"mousedown",onmousemove:"mousemove",onmouseout:"mouseout",onmouseover:"mouseover",onmouseup:"mouseup",onwheel:"wheel",onanimationend:"animationend",onanimationstart:"animationstart",ondrag:"drag",ondragend:"dragend",ondragenter:"dragenter",ondragexit:"dragexit",ondragleave:"dragleave",ondragover:"dragover",ondragstop:"dragstop",ondrop:"drop"},f="ACTION";function p(){var n=document.createElement("div");return e(n,Element.prototype.cloneNode.call(this,!0)),n}function h(e,n){var t=p.call(n);return t.eventStream=d(e,function e(n,t){var r=[];Object.keys(v).forEach(function(e){if(t[e]&&t[e].mapFn){var o=t[e].mapFn;r.push(d(o,g(e,n,o)))}});for(var o=c(r),i=0;i<n.children.length;i++)o=u(o,e(n.children[i],t.children[i]));return o}(t,n)),t}function k(o){var a=o.mount,u=o.init,c=o.update,l=o.view,v=o.runTasks,p=o.scheduler||t(),h=n(),k=i(function(e,n){var t,r,o,i=c(e,n.action,p);Array.isArray(i)?(o=(t=i)[0],r=t[1]):o=i,console.log({nextModel:o,task:r,updateResult:i});var a=l(o);return{seed:o,value:{view:a,task:r,eventStream:m(1,d(function(e){return{action:e}},a.eventStream))}}},u,{run:function(e,n){var t=function(t){return e.event(n.currentTime(),t)};return h.on(f,t),{dispose:function(){h.off(f,t)}}}}),g={event:function(n,t){var o=t.eventStream?null:t;if(o){var i={eventStream:s(o)};return this.event.call(this,n,i)}var u=t;if(u.view&&e(a,u.view,{onBeforeElUpdated:w}),u.task&&!1!==v){var c=Array.isArray(u.task)?u.task:[u.task],d=r();c.forEach(function(e){var n=e(g,p);d.add(n)}),d.runTasks(0,function(e){return e.run()})}var m=u.eventStream.run({event:function(e,n){n.time||(n.time=e),h.emit(f,n)},end:function(){m.dispose()},error:function(e,n){throw console.error(n),n}},p)},end:function(){},error:function(e,n){throw console.error(n),n}};return{applicationStream:k,applicationSink:g,scheduler:p,eventSource:h,run:function(e){var n=k.run(g,p);return h.emit(f,{time:p.currentTime(),action:e}),n}}}function g(e,n,t){var r,o;return n&&(n[e]=function(e){r&&r.event(o.currentTime(),e)},n[e].mapFn=t),{run:function(e,n){return r=e,o=n,{dispose:function(){r=void 0}}}}}function S(e,n){for(var t=[],r=arguments.length-2;r-- >0;)t[r]=arguments[r+2];var o=document.createElement(e);return o.eventStream=a(),n&&Object.keys(n).forEach(function(e){var t=n[e];if(v[e]&&t){var r=t.constructor===Function?t:function(){return t};o.eventStream=u(o.eventStream,d(r,g(e,o,r)))}else-1===["className","id"].indexOf(e)?null!=t&&o.setAttribute(e,t):o[e]=t}),t.forEach(function e(n){if("number"!=typeof n){if(n)if(n&&n.constructor===String){var t=document.createTextNode(n);o.appendChild(t)}else Array.isArray(n)?n.forEach(e):(o.appendChild(n),o.eventStream=u(o.eventStream,n.eventStream),o.cloneNode=p,n.eventStream=null)}else{var r=document.createTextNode(n.toString());o.appendChild(r)}}),o}function y(n,t){0===n.children.length&&n.appendChild(t),e(n.children[0],t,{onBeforeElUpdated:w})}function w(e,n){return Object.keys(v).forEach(function(t){n[t]?e[t]=n[t]:e[t]&&(e[t]=void 0)}),!0}function b(e,n){var t,r=[],i=function(e){!t&&e.time&&(t=e.time-500),r.push(e)};return e.on(f,i),function(a){var d=a.mount,m=a.update,s=a.view,v=a.init;e.off(f,i);var p=o(-1*(t-n.currentTime()),n),h=k({view:s,update:m,init:v,mount:d,scheduler:p,runTasks:!1}),g=h.applicationSink,S=h.applicationStream,y=c(r.map(function(e){return l(e.time,e)}));u(S,y).run(g,p)}}export{f as ACTION,p as cloneNode,h as mapElement,k as createApplication,S as createElement,y as render,b as record};
//# sourceMappingURL=frpuccino.m.js.map
