function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}var n=e(require("morphdom")),r=e(require("mitt")),t=require("@most/scheduler"),o=require("@most/core"),a={onblur:"blur",onchange:"change",oncontextmenu:"contextmenu",onfocus:"focus",oninput:"input",oninvalid:"invalid",onreset:"reset",onsearch:"search",onselect:"select",onsubmit:"submit",onkeydown:"keydown",onkeypress:"keypress",onkeyup:"keyup",onclick:"click",ondblclick:"dblclick",onmousedown:"mousedown",onmousemove:"mousemove",onmouseout:"mouseout",onmouseover:"mouseover",onmouseup:"mouseup",onwheel:"wheel",onanimationend:"animationend",onanimationstart:"animationstart",ondrag:"drag",ondragend:"dragend",ondragenter:"dragenter",ondragexit:"dragexit",ondragleave:"dragleave",ondragover:"dragover",ondragstop:"dragstop",ondrop:"drop"},i="ACTION";function u(){var e=document.createElement("div");return n(e,Element.prototype.cloneNode.call(this,!0)),e}function c(e){var a=e.mount,u=e.init,c=e.update,m=e.view,s=e.runTasks,l=e.scheduler||t.newDefaultScheduler(),v=r(),f=o.loop(function(e,n){var r,t,a,i=c(e,n.action,l);Array.isArray(i)&&"function"==typeof i[1]?(a=(r=i)[0],t=r[1]):a=i;var u=m(a);return{seed:a,value:{view:u,task:t,eventStream:o.take(1,o.map(function(e){return{action:e}},u.eventStream))}}},u,{run:function(e,n){var r=function(r){return e.event(n.currentTime(),r)};return v.on(i,r),{dispose:function(){v.off(i,r)}}}}),p={event:function(e,r){var u=r.eventStream?null:r;if(u){var c={eventStream:o.now(u)};return this.event.call(this,e,c)}var m=r;if(m.view&&n(a,m.view,{onBeforeElUpdated:d}),m.task&&!1!==s){var f=Array.isArray(m.task)?m.task:[m.task],h=t.newTimeline();f.forEach(function(e){var n=e(p,l);h.add(n)}),h.runTasks(0,function(e){return e.run()})}var g=m.eventStream.run({event:function(e,n){n.time||(n.time=e),v.emit(i,n)},end:function(){g.dispose()},error:function(e,n){throw console.error(n),n}},l)},end:function(){},error:function(e,n){throw console.error(n),n}};return{applicationStream:f,applicationSink:p,scheduler:l,eventSource:v,run:function(e){var n=f.run(p,l);return v.emit(i,{time:l.currentTime(),action:e}),n}}}function m(e,n,r){var t,o;return n&&(n[e]=function(e){t&&t.event(o.currentTime(),e)},n[e].mapFn=r),{run:function(e,n){return t=e,o=n,{dispose:function(){t=void 0}}}}}function d(e,n){return Object.keys(a).forEach(function(r){n[r]?e[r]=n[r]:e[r]&&(e[r]=void 0)}),!0}exports.ACTION=i,exports.cloneNode=u,exports.mapElement=function(e,n){var r=u.call(n);return r.eventStream=o.map(e,function e(n,r){var t=[];Object.keys(a).forEach(function(e){if(r[e]&&r[e].mapFn){var a=r[e].mapFn;t.push(o.map(a,m(e,n,a)))}});for(var i=o.mergeArray(t),u=0;u<n.children.length;u++)i=o.merge(i,e(n.children[u],r.children[u]));return i}(r,n)),r},exports.createApplication=c,exports.createElement=function(e,n){for(var r=[],t=arguments.length-2;t-- >0;)r[t]=arguments[t+2];var i=document.createElement(e);return i.eventStream=o.empty(),n&&Object.keys(n).forEach(function(e){var r=n[e];if(a[e]&&r){var t=r.constructor===Function?r:function(){return r};i.eventStream=o.merge(i.eventStream,o.map(t,m(e,i,t)))}else-1===["className","id"].indexOf(e)?null!=r&&i.setAttribute(e,r):i[e]=r}),r.forEach(function e(n){if("number"!=typeof n){if(n)if(n&&n.constructor===String){var r=document.createTextNode(n);i.appendChild(r)}else Array.isArray(n)?n.forEach(e):(i.appendChild(n),i.eventStream=o.merge(i.eventStream,n.eventStream),i.cloneNode=u,n.eventStream=null)}else{var t=document.createTextNode(n.toString());i.appendChild(t)}}),i},exports.render=function(e,r){0===e.children.length&&e.appendChild(r),n(e.children[0],r,{onBeforeElUpdated:d})},exports.record=function(e,n){var r,a=[],u=function(e){!r&&e.time&&(r=e.time-500),a.push(e)};return e.on(i,u),function(m){var d=m.mount,s=m.update,l=m.view,v=m.init;e.off(i,u);var f=t.schedulerRelativeTo(-1*(r-n.currentTime()),n),p=c({view:l,update:s,init:v,mount:d,scheduler:f,runTasks:!1}),h=p.applicationSink,g=p.applicationStream,k=o.mergeArray(a.map(function(e){return o.at(e.time,e)}));o.merge(g,k).run(h,f)}};
//# sourceMappingURL=frpuccino.js.map
